- hosts: swarm-manager
  roles:
    - names
  sudo: yes
  remote_user: dbnet
  tasks:
  - name: Run manager
    shell: docker run -d -p 2375:2375 swarm manage consul://136.199.51.110:8500

  - name: Create overlay network
    shell: docker -H 0.0.0.0:2375 network create --driver overlay hadoop-cluster

  - name: Run hadoop containers with specified names
    shell: docker -H 0.0.0.0:2375  run -itd -v /home/dbnet/swarm_resources:/mnt --net="hadoop-cluster" --hostname={{ item }}  --name={{ item }} carnuel/hado$
    with_items: names

  - stat: path=container_Names.txt
    register: st

  - name: Delete old container_Names.txt
    when: st.stat.exists
    shell: rm container_Names.txt

  - name: Save long docker-name of Hadoop Containers to file
    shell: echo -n $(docker -H 0.0.0.0:2375 inspect --format={{'{{'}}.Node.Name{{'}}'}} {{item}}) >> container_Names.txt ; echo -n '%2Fsystem.slice%2Fdocker-' >> container_Names.txt ; echo $(docker -H 0.0.0.0:2375 inspect --format={{'{{'}}.Id{{'}}'}} {{item}}) >> container_Names.txt
    with_items: names
